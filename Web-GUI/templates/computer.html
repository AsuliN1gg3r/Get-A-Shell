{% extends "main_base.html" %}
    {% block content %}
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.0/socket.io.min.js"></script>
        <script>
            function execute_command()
            {   
                var command = document.getElementsByName("command-input")[0];
                if (command.value.trim() == "")
                    return;
                var prompt = document.getElementsByName("prompt")[0];
                var command_option = document.createElement("option");
                var command_value = command.value
                command_option.text = "> " + command_value;
                command_option.className = "command-option"
                prompt.add(command_option);
                
                
                // Send to server
                var socket = io.connect('http://127.0.0.1:5000');
                socket.on('connect', function() {
                    socket.send("{{ computer.id }}" + "*c" + command_value);
                });
                
                socket.on('message', function(msg) {
                    response_option = document.createElement("option");
                    response_option.text = msg
                    response_option.title = msg
                    response_option.className = "response-option"
                    response_option.disabled = true
                    prompt.add(response_option);
                });
 
                command.value = ""
            }

            function apply_computer_name()
            {   
                var computer_name = document.getElementsByName("computer_name-input")[0].value;
                console.log(computer_name);
                if (computer_name.trim() == "")
                    return;
                
                // Send to server
                var socket = io.connect('http://127.0.0.1:5000');
                socket.on('connect', function() {
                    socket.send("{{ computer.id }}" + "*n" + computer_name);
                });
            }
        
        </script>

        <script>
            function openTab(evt, cityName) {
                // Declare all variables
                var i, tabcontent, tablinks;

                // Get all elements with class="tabcontent" and hide them
                tabcontent = document.getElementsByClassName("tab-content");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }

                // Get all elements with class="tablinks" and remove the class "active"
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }

                // Show the current tab, and add an "active" class to the button that opened the tab
                document.getElementById(cityName).style.display = "block";
                evt.currentTarget.className += " active";
                }
        </script>

        <title>Computer ~{{ computer.name }}~</title>

        <div class="content">

            <header>

                <h1>{{ computer.ip }} ~{{ computer.name }}~</h1> 
                <span class="dot" style="background-color: {% if computer.active %} green {% else %} red {% endif %};"></span>
                {% if computer.active %} Active {% else %} Inactive {% endif %}
                <hr>

                <!--Tabs Navigator-->
                <div class="tab">
                    <button class="tablinks" onclick="openTab(event, 'info')" id="default">Info</button>
                    <button class="tablinks" onclick="openTab(event, 'console')" {% if not computer.active %} disabled="disabled" {% endif %}>Console</button>
                    <button class="tablinks" onclick="openTab(event, 'config')">Config</button>
                </div>

            </header>

            <main>

                <!--Info Tab-->
                <div id="info" class="tab-content">
                    <h2>Info:</h2>
                    <pre>
Host Name:                 DESKTOP-RTBK1DV
OS Name:                   ‏‏Microsoft Windows 10 Education
OS Version:                10.0.19042 N/A Build 19042
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          Eyal Asulin
Registered Organization:
Product ID:                00328-00201-16516-AA640
Original Install Date:     10/25/2020, 12:18:37
System Boot Time:          04/07/2021, 22:09:48
System Manufacturer:       LENOVO
System Model:              10A7-S030IV
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: Intel64 Family 6 Model 60 Stepping 3 GenuineIntel ~3301 Mhz
BIOS Version:              LENOVO FBKTB4AUS, 07/01/2015
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             he;Hebrew
Input Locale:              he;Hebrew
Time Zone:                 (UTC+02:00) Jerusalem
Total Physical Memory:     12,210 MB
Available Physical Memory: 6,646 MB
Virtual Memory: Max Size:  14,066 MB
Virtual Memory: Available: 7,702 MB
Virtual Memory: In Use:    6,364 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    WORKGROUP
Logon Server:              \\DESKTOP-RTBK1DV
Hotfix(s):                 11 Hotfix(s) Installed.
                           [01]: KB4601554
                           [02]: KB4562830
                           [03]: KB4570334
                           [04]: KB4577266
                           [05]: KB4577586
                           [06]: KB4580325
                           [07]: KB4586864
                           [08]: KB4593175
                           [09]: KB4598481
                           [10]: KB5000802
                           [11]: KB5000858
Network Card(s):           3 NIC(s) Installed.
                           [01]: Intel(R) Ethernet Connection I217-LM
                                 Connection Name: ‏‏Ethernet
                                 DHCP Enabled:    Yes
                                 DHCP Server:     192.168.1.1
                                 IP address(es)
                                 [01]: 192.168.1.12
                                 [02]: fe80::b12f:4447:d329:eac
                                 [03]: 2a00:a040:196:f461:e065:c885:fc05:95c0
                                 [04]: 2a00:a040:196:f461:b12f:4447:d329:eac
                                 [05]: 2a00:a040:196:f461::1003
                           [02]: VirtualBox Host-Only Ethernet Adapter
                                 Connection Name: VirtualBox Host-Only Network
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 192.168.56.1
                                 [02]: fe80::947d:e251:8123:8424
                           [03]: Bluetooth Device (Personal Area Network)
                                 Connection Name: ‏‏חיבור רשת של Bluetooth
                                 Status:          Media disconnected
Hyper-V Requirements:      VM Monitor Mode Extensions: Yes
                           Virtualization Enabled In Firmware: Yes
                           Second Level Address Translation: Yes
                           Data Execution Prevention Available: Yes
                    </pre>
                </div>

                <!--Console Tab-->
                <div id="console" class="tab-content">
                    <h2>Console:</h2>
                    <select name="prompt" id="prompt" Size="20"></select>  
                    <br>
                    <input type="text" name="command-input" class="textbox" id="command" placeholder="Command" />
                    <button id="execute" onclick="execute_command()">Execute</button>
                </div>

                <!--Config Tab-->
                <div id="config" class="tab-content">
                    <h2>Config:</h2>
                    <label>Computer Name:</label>
                    <input type="text" name="computer_name-input" class="textbox" id="computer_name" value="{{ computer.name }}"/>
                    <button onclick="apply_computer_name()">Apply</button>
                </div>

            </main>

        </div>

        <script>document.getElementById("default").click();</script>

    {% endblock %}
